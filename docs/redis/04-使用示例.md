# Redis Commons - ä½¿ç”¨ç¤ºä¾‹

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Maven ä¾èµ–é…ç½®

```xml
<dependency>
    <groupId>com.david</groupId>
    <artifactId>redis-commons</artifactId>
    <version>0.0.1-SNAPSHOT</version>
</dependency>
```

### é…ç½®æ–‡ä»¶è®¾ç½®

```yaml
spring:
  data:
    redis:
      host: localhost
      port: 6379
      password: your_password
      database: 0
      lettuce:
        pool:
          max-active: 20
          max-idle: 10
          min-idle: 5
      commons:
        enabled: true
        cache:
          key-prefix: "app:"
          default-ttl: 3600s
        lock:
          key-prefix: "lock:"
          default-wait-time: 10s
          default-lease-time: 30s
          retry-attempts: 3
        transaction:
          enabled: true
```

## ğŸ“š åŸºç¡€æ•°æ®æ“ä½œç¤ºä¾‹

### String ç±»å‹æ“ä½œ

```java
@Service
public class UserCacheService {

    @Autowired
    private RedisUtils redisUtils;

    /**
     * åŸºç¡€ String æ“ä½œç¤ºä¾‹
     */
    public void stringOperationsDemo() {
        // 1. è®¾ç½®ç®€å•é”®å€¼å¯¹
        redisUtils.strings().set("user:name", "å¼ ä¸‰");

        // 2. è®¾ç½®å¸¦è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹
        redisUtils.strings().set("session:token123", "user-data", Duration.ofHours(2));

        // 3. è·å–å­—ç¬¦ä¸²å€¼
        String userName = redisUtils.strings().getString("user:name");

        // 4. è·å–æŒ‡å®šç±»å‹çš„å€¼
        UserInfo user = redisUtils.strings().get("user:info:123", UserInfo.class);

        // 5. æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨
        boolean exists = redisUtils.strings().hasKey("user:name");

        // 6. è®¾ç½®è¿‡æœŸæ—¶é—´
        redisUtils.strings().expire("user:name", Duration.ofMinutes(30));

        // 7. è·å–å‰©ä½™è¿‡æœŸæ—¶é—´
        Long ttl = redisUtils.strings().getExpire("user:name");

        // 8. åˆ é™¤é”®
        redisUtils.strings().delete("user:name");
    }

    /**
     * æ‰¹é‡æ“ä½œç¤ºä¾‹
     */
    public void batchOperationsDemo() {
        // 1. æ‰¹é‡è®¾ç½®
        Map<String, Object> keyValues = new HashMap<>();
        keyValues.put("user:1", "å¼ ä¸‰");
        keyValues.put("user:2", "æå››");
        keyValues.put("user:3", "ç‹äº”");
        redisUtils.strings().multiSet(keyValues);

        // 2. æ‰¹é‡è·å–
        List<String> keys = Arrays.asList("user:1", "user:2", "user:3");
        List<Object> values = redisUtils.strings().multiGet(keys);

        // 3. æ‰¹é‡åˆ é™¤
        Long deletedCount = redisUtils.strings().delete("user:1", "user:2", "user:3");

        // 4. æ¨¡å¼åŒ¹é…æŸ¥æ‰¾
        Set<String> userKeys = redisUtils.strings().scanKeys("user:*");
    }
}
```

### Hash ç±»å‹æ“ä½œ

```java
@Service
public class UserProfileService {

    @Autowired
    private RedisUtils redisUtils;

    /**
     * Hash æ“ä½œç¤ºä¾‹
     */
    public void hashOperationsDemo() {
        String userKey = "user:profile:123";

        // 1. è®¾ç½®å•ä¸ªå­—æ®µ
        redisUtils.hashes().hset(userKey, "name", "å¼ ä¸‰");
        redisUtils.hashes().hset(userKey, "age", 25);
        redisUtils.hashes().hset(userKey, "email", "zhangsan@example.com");

        // 2. æ‰¹é‡è®¾ç½®å­—æ®µ
        Map<String, Object> profile = new HashMap<>();
        profile.put("city", "åŒ—äº¬");
        profile.put("department", "æŠ€æœ¯éƒ¨");
        profile.put("position", "Javaå¼€å‘å·¥ç¨‹å¸ˆ");
        redisUtils.hashes().hmset(userKey, profile);

        // 3. è·å–å•ä¸ªå­—æ®µ
        String userName = redisUtils.hashes().hget(userKey, "name", String.class);
        Integer age = redisUtils.hashes().hget(userKey, "age", Integer.class);

        // 4. è·å–æ‰€æœ‰å­—æ®µ
        Map<String, Object> allFields = redisUtils.hashes().hgetall(userKey);

        // 5. æ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨
        boolean hasEmail = redisUtils.hashes().hexists(userKey, "email");

        // 6. è·å–æ‰€æœ‰å­—æ®µå
        Set<String> fieldNames = redisUtils.hashes().hkeys(userKey);

        // 7. æ•°å€¼å¢æ“ä½œ
        redisUtils.hashes().hincrBy(userKey, "loginCount", 1);

        // 8. åˆ é™¤å­—æ®µ
        redisUtils.hashes().hdel(userKey, "email");
    }

    /**
     * ç”¨æˆ·ç§¯åˆ†ç®¡ç†ç¤ºä¾‹
     */
    public void userScoreDemo() {
        String scoreKey = "user:score:123";

        // åˆå§‹åŒ–ç”¨æˆ·ç§¯åˆ†
        Map<String, Object> scores = new HashMap<>();
        scores.put("totalScore", 0);
        scores.put("levelScore", 0);
        scores.put("bonusScore", 0);
        redisUtils.hashes().hmset(scoreKey, scores);

        // å¢åŠ ç§¯åˆ†
        long newTotalScore = redisUtils.hashes().hincrBy(scoreKey, "totalScore", 50);
        redisUtils.hashes().hincrBy(scoreKey, "levelScore", 30);
        redisUtils.hashes().hincrBy(scoreKey, "bonusScore", 20);

        // æŸ¥è¯¢å½“å‰ç§¯åˆ†
        Map<String, Object> currentScores = redisUtils.hashes().hgetall(scoreKey);
        System.out.println("ç”¨æˆ·å½“å‰ç§¯åˆ†: " + currentScores);
    }
}
```

### List ç±»å‹æ“ä½œ

```java
@Service
public class MessageQueueService {

    @Autowired
    private RedisUtils redisUtils;

    /**
     * æ¶ˆæ¯é˜Ÿåˆ—ç¤ºä¾‹
     */
    public void messageQueueDemo() {
        String queueKey = "message:queue:urgent";

        // 1. å‘é˜Ÿåˆ—å°¾éƒ¨æ¨å…¥æ¶ˆæ¯ï¼ˆç”Ÿäº§è€…ï¼‰
        redisUtils.lists().rpush(queueKey, "è®¢å•æ”¯ä»˜æ¶ˆæ¯");
        redisUtils.lists().rpush(queueKey, "ç”¨æˆ·æ³¨å†Œæ¶ˆæ¯");
        redisUtils.lists().rpush(queueKey, "ç³»ç»Ÿé€šçŸ¥æ¶ˆæ¯");

        // 2. ä»é˜Ÿåˆ—å¤´éƒ¨è·å–æ¶ˆæ¯ï¼ˆæ¶ˆè´¹è€…ï¼‰
        String message1 = redisUtils.lists().lpop(queueKey, String.class);
        String message2 = redisUtils.lists().lpop(queueKey, String.class);

        // 3. æŸ¥çœ‹é˜Ÿåˆ—é•¿åº¦
        Long queueLength = redisUtils.lists().llen(queueKey);

        // 4. æŸ¥çœ‹é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼ˆä¸ç§»é™¤ï¼‰
        List<String> messages = redisUtils.lists().lrange(queueKey, 0, -1, String.class);

        // 5. è·å–æŒ‡å®šç´¢å¼•çš„æ¶ˆæ¯
        String firstMessage = redisUtils.lists().lindex(queueKey, 0, String.class);

        // 6. ä¿®æ”¹æŒ‡å®šç´¢å¼•çš„æ¶ˆæ¯
        redisUtils.lists().lset(queueKey, 0, "æ›´æ–°åçš„æ¶ˆæ¯");

        // 7. è£å‰ªåˆ—è¡¨ï¼ˆä¿ç•™æŒ‡å®šèŒƒå›´çš„å…ƒç´ ï¼‰
        redisUtils.lists().ltrim(queueKey, 0, 99); // åªä¿ç•™å‰100ä¸ªå…ƒç´ 
    }

    /**
     * ä»»åŠ¡å¤„ç†é˜Ÿåˆ—ç¤ºä¾‹
     */
    public void taskProcessingDemo() {
        String taskQueue = "task:processing";

        // ä»»åŠ¡ç”Ÿäº§è€…
        for (int i = 1; i <= 10; i++) {
            Task task = new Task("task-" + i, "å¤„ç†ç”¨æˆ·æ•°æ®", System.currentTimeMillis());
            redisUtils.lists().rpush(taskQueue, task);
        }

        // ä»»åŠ¡æ¶ˆè´¹è€…
        while (redisUtils.lists().llen(taskQueue) > 0) {
            Task task = redisUtils.lists().lpop(taskQueue, Task.class);
            if (task != null) {
                System.out.println("å¤„ç†ä»»åŠ¡: " + task.getName());
                // æ‰§è¡Œä»»åŠ¡é€»è¾‘...
            }
        }
    }
}
```

### Set ç±»å‹æ“ä½œ

```java
@Service
public class TagService {

    @Autowired
    private RedisUtils redisUtils;

    /**
     * æ ‡ç­¾ç®¡ç†ç¤ºä¾‹
     */
    public void tagManagementDemo() {
        String userTagsKey = "user:tags:123";

        // 1. æ·»åŠ ç”¨æˆ·æ ‡ç­¾
        redisUtils.sets().sadd(userTagsKey, "Java", "Spring", "Redis", "MySQL");

        // 2. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æŸä¸ªæ ‡ç­¾
        boolean hasJavaTag = redisUtils.sets().sismember(userTagsKey, "Java");

        // 3. è·å–ç”¨æˆ·æ‰€æœ‰æ ‡ç­¾
        Set<Object> allTags = redisUtils.sets().smembers(userTagsKey);

        // 4. éšæœºè·å–ä¸€ä¸ªæ ‡ç­¾
        String randomTag = redisUtils.sets().srandmember(userTagsKey, String.class);

        // 5. ç§»é™¤ç”¨æˆ·æ ‡ç­¾
        redisUtils.sets().srem(userTagsKey, "MySQL");

        // 6. è·å–æ ‡ç­¾æ•°é‡
        Long tagCount = redisUtils.sets().scard(userTagsKey);
    }

    /**
     * ç”¨æˆ·å…³ç³»ç®¡ç†ç¤ºä¾‹
     */
    public void userRelationDemo() {
        String user1Followers = "user:followers:123"; // ç”¨æˆ·123çš„ç²‰ä¸
        String user2Followers = "user:followers:456"; // ç”¨æˆ·456çš„ç²‰ä¸

        // æ·»åŠ ç²‰ä¸
        redisUtils.sets().sadd(user1Followers, "user:789", "user:101", "user:102");
        redisUtils.sets().sadd(user2Followers, "user:101", "user:102", "user:103");

        // å…±åŒç²‰ä¸ï¼ˆäº¤é›†ï¼‰
        Set<Object> commonFollowers = redisUtils.sets().sinter(user1Followers, user2Followers);

        // ç”¨æˆ·123ç‹¬æœ‰çš„ç²‰ä¸ï¼ˆå·®é›†ï¼‰
        Set<Object> uniqueFollowers = redisUtils.sets().sdiff(user1Followers, user2Followers);

        // æ‰€æœ‰ç²‰ä¸ï¼ˆå¹¶é›†ï¼‰
        Set<Object> allFollowers = redisUtils.sets().sunion(user1Followers, user2Followers);

        System.out.println("å…±åŒç²‰ä¸: " + commonFollowers);
        System.out.println("ç‹¬æœ‰ç²‰ä¸: " + uniqueFollowers);
        System.out.println("æ‰€æœ‰ç²‰ä¸: " + allFollowers);
    }
}
```

### ZSet ç±»å‹æ“ä½œ

```java
@Service
public class RankingService {

    @Autowired
    private RedisUtils redisUtils;

    /**
     * æ’è¡Œæ¦œç¤ºä¾‹
     */
    public void leaderboardDemo() {
        String leaderboard = "game:leaderboard";

        // 1. æ·»åŠ ç”¨æˆ·åˆ†æ•°
        redisUtils.zsets().zadd(leaderboard, 1500.0, "player1");
        redisUtils.zsets().zadd(leaderboard, 2300.0, "player2");
        redisUtils.zsets().zadd(leaderboard, 1800.0, "player3");
        redisUtils.zsets().zadd(leaderboard, 2100.0, "player4");

        // 2. è·å–ç”¨æˆ·åˆ†æ•°
        Double player1Score = redisUtils.zsets().zscore(leaderboard, "player1");

        // 3. è·å–ç”¨æˆ·æ’åï¼ˆä»å°åˆ°å¤§ï¼‰
        Long player1Rank = redisUtils.zsets().zrank(leaderboard, "player1");

        // 4. è·å–ç”¨æˆ·æ’åï¼ˆä»å¤§åˆ°å°ï¼‰
        Long player1RevRank = redisUtils.zsets().zrevrank(leaderboard, "player1");

        // 5. è·å–æ’è¡Œæ¦œå‰10å
        Set<String> top10 = redisUtils.zsets().zrevrange(leaderboard, 0, 9, String.class);

        // 6. è·å–æŒ‡å®šåˆ†æ•°èŒƒå›´çš„ç©å®¶
        Set<String> midRangeUsers = redisUtils.zsets().zrangeByScore(
            leaderboard, 1500.0, 2000.0, String.class);

        // 7. è·å–æ’è¡Œæ¦œæ€»äººæ•°
        Long totalPlayers = redisUtils.zsets().zcard(leaderboard);

        // 8. ç»Ÿè®¡æŒ‡å®šåˆ†æ•°èŒƒå›´çš„äººæ•°
        Long midRangeCount = redisUtils.zsets().zcount(leaderboard, 1500.0, 2000.0);

        System.out.println("å‰10å: " + top10);
        System.out.println("ä¸­ç­‰åˆ†æ•°ç©å®¶: " + midRangeUsers);
    }

    /**
     * çƒ­ç‚¹æ–‡ç« æ’åç¤ºä¾‹
     */
    public void hotArticlesDemo() {
        String hotArticles = "articles:hot";

        // æ–‡ç« å‘å¸ƒæ—¶çš„åˆå§‹åˆ†æ•°
        redisUtils.zsets().zadd(hotArticles, calculateInitialScore("article:1"), "article:1");
        redisUtils.zsets().zadd(hotArticles, calculateInitialScore("article:2"), "article:2");

        // ç”¨æˆ·ç‚¹èµæ–‡ç« ï¼Œå¢åŠ çƒ­åº¦åˆ†æ•°
        redisUtils.zsets().zincrby(hotArticles, 10.0, "article:1");

        // ç”¨æˆ·è¯„è®ºæ–‡ç« ï¼Œå¢åŠ çƒ­åº¦åˆ†æ•°
        redisUtils.zsets().zincrby(hotArticles, 5.0, "article:1");

        // è·å–çƒ­ç‚¹æ–‡ç« æ’è¡Œæ¦œ
        Set<String> hotRanking = redisUtils.zsets().zrevrange(hotArticles, 0, 19, String.class);

        System.out.println("çƒ­ç‚¹æ–‡ç« Top20: " + hotRanking);
    }

    private double calculateInitialScore(String articleId) {
        // åŸºäºå‘å¸ƒæ—¶é—´ã€ä½œè€…æƒé‡ç­‰è®¡ç®—åˆå§‹åˆ†æ•°
        return System.currentTimeMillis() / 1000.0;
    }
}
```

## ğŸ”’ åˆ†å¸ƒå¼é”ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€é”æ“ä½œ

```java
@Service
public class OrderService {

    @Autowired
    private RedisUtils redisUtils;

    /**
     * åŸºç¡€åˆ†å¸ƒå¼é”ç¤ºä¾‹
     */
    public String processOrder(Long orderId) {
        String lockKey = "order:lock:" + orderId;

        try {
            // å°è¯•è·å–é”ï¼Œç­‰å¾…10ç§’ï¼Œé”æŒæœ‰30ç§’
            return redisUtils.locks().tryLock(lockKey, Duration.ofSeconds(10),
                Duration.ofSeconds(30), () -> {
                    // åœ¨é”ä¿æŠ¤ä¸‹æ‰§è¡Œä¸šåŠ¡é€»è¾‘
                    System.out.println("å¼€å§‹å¤„ç†è®¢å•: " + orderId);

                    // æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†
                    try {
                        Thread.sleep(5000);
                    } catch (InterruptedException e) {
                        Thread.currentThread().interrupt();
                    }

                    System.out.println("è®¢å•å¤„ç†å®Œæˆ: " + orderId);
                    return "è®¢å•å¤„ç†æˆåŠŸ";
                });
        } catch (Exception e) {
            return "è®¢å•å¤„ç†å¤±è´¥: " + e.getMessage();
        }
    }

    /**
     * å¸¦é‡è¯•æœºåˆ¶çš„é”ç¤ºä¾‹
     */
    public void processWithRetry(Long orderId) {
        String lockKey = "order:retry:" + orderId;

        try {
            redisUtils.locks().executeWithLockRetry(lockKey,
                Duration.ofSeconds(5), Duration.ofSeconds(30), () -> {
                    // æ‰§è¡Œå¯èƒ½å¤±è´¥çš„ä¸šåŠ¡é€»è¾‘
                    return processOrderInternal(orderId);
                });
        } catch (Exception e) {
            System.err.println("é‡è¯•åä»ç„¶å¤±è´¥: " + e.getMessage());
        }
    }

    /**
     * å¸¦é™çº§ç­–ç•¥çš„é”ç¤ºä¾‹
     */
    public String processWithFallback(Long orderId) {
        String lockKey = "order:fallback:" + orderId;

        return redisUtils.locks().executeWithLockOrFallback(lockKey,
            Duration.ofSeconds(1), Duration.ofSeconds(10),
            // ä¸»è¦æ“ä½œï¼šå®Œæ•´çš„è®¢å•å¤„ç†
            () -> {
                System.out.println("æ‰§è¡Œå®Œæ•´è®¢å•å¤„ç†");
                return processOrderInternal(orderId);
            },
            // é™çº§æ“ä½œï¼šå¿«é€Ÿå¤„ç†
            () -> {
                System.out.println("æ‰§è¡Œé™çº§è®¢å•å¤„ç†");
                return processOrderQuickly(orderId);
            });
    }

    private String processOrderInternal(Long orderId) {
        // å®Œæ•´çš„è®¢å•å¤„ç†é€»è¾‘
        return "è®¢å•å¤„ç†å®Œæˆ";
    }

    private String processOrderQuickly(Long orderId) {
        // å¿«é€Ÿå¤„ç†é€»è¾‘
        return "è®¢å•å¿«é€Ÿå¤„ç†å®Œæˆ";
    }
}
```

### åº“å­˜ç®¡ç†é”ç¤ºä¾‹

```java
@Service
public class InventoryService {

    @Autowired
    private RedisUtils redisUtils;

    /**
     * å‡åº“å­˜æ“ä½œ
     */
    public boolean decreaseInventory(Long productId, int quantity) {
        String lockKey = "inventory:lock:" + productId;
        String inventoryKey = "inventory:" + productId;

        return redisUtils.locks().executeWithLock(lockKey, () -> {
            // è·å–å½“å‰åº“å­˜
            Integer currentInventory = redisUtils.strings().get(inventoryKey, Integer.class);
            if (currentInventory == null) {
                currentInventory = 0;
            }

            // æ£€æŸ¥åº“å­˜æ˜¯å¦è¶³å¤Ÿ
            if (currentInventory < quantity) {
                throw new RuntimeException("åº“å­˜ä¸è¶³");
            }

            // å‡åº“å­˜
            int newInventory = currentInventory - quantity;
            redisUtils.strings().set(inventoryKey, newInventory);

            System.out.println("å‡åº“å­˜æˆåŠŸ: " + productId + ", å‰©ä½™: " + newInventory);
            return true;
        });
    }

    /**
     * æ‰¹é‡å‡åº“å­˜æ“ä½œ
     */
    public boolean batchDecreaseInventory(Map<Long, Integer> productQuantities) {
        // ä¸ºé¿å…æ­»é”ï¼Œå¯¹äº§å“IDè¿›è¡Œæ’åº
        List<Long> sortedProductIds = productQuantities.keySet().stream()
            .sorted()
            .collect(Collectors.toList());

        return redisUtils.locks().executeWithLock("inventory:batch:lock", () -> {
            for (Long productId : sortedProductIds) {
                int quantity = productQuantities.get(productId);
                if (!decreaseInventory(productId, quantity)) {
                    throw new RuntimeException("æ‰¹é‡å‡åº“å­˜å¤±è´¥ï¼Œäº§å“ID: " + productId);
                }
            }
            return true;
        });
    }
}
```

## ğŸ”„ äº‹åŠ¡æ“ä½œç¤ºä¾‹

### å£°æ˜å¼äº‹åŠ¡

```java
@Service
public class AccountService {

    @Autowired
    private RedisUtils redisUtils;

    /**
     * å£°æ˜å¼äº‹åŠ¡ç¤ºä¾‹
     */
    @RedisTransactional(timeout = 30)
    public void transferMoney(String fromAccount, String toAccount, BigDecimal amount) {
        String fromKey = "account:balance:" + fromAccount;
        String toKey = "account:balance:" + toAccount;

        // è·å–è½¬å‡ºè´¦æˆ·ä½™é¢
        BigDecimal fromBalance = redisUtils.strings().get(fromKey, BigDecimal.class);
        if (fromBalance == null || fromBalance.compareTo(amount) < 0) {
            throw new RuntimeException("ä½™é¢ä¸è¶³");
        }

        // è·å–è½¬å…¥è´¦æˆ·ä½™é¢
        BigDecimal toBalance = redisUtils.strings().get(toKey, BigDecimal.class);
        if (toBalance == null) {
            toBalance = BigDecimal.ZERO;
        }

        // æ›´æ–°ä½™é¢
        redisUtils.strings().set(fromKey, fromBalance.subtract(amount));
        redisUtils.strings().set(toKey, toBalance.add(amount));

        // è®°å½•äº¤æ˜“æ—¥å¿—
        String logKey = "transaction:log:" + System.currentTimeMillis();
        TransactionLog log = new TransactionLog(fromAccount, toAccount, amount, new Date());
        redisUtils.strings().set(logKey, log, Duration.ofDays(30));

        System.out.println("è½¬è´¦æˆåŠŸ: " + fromAccount + " -> " + toAccount + ", é‡‘é¢: " + amount);
    }
}
```

### ç¼–ç¨‹å¼äº‹åŠ¡

```java
@Service
public class OrderTransactionService {

    @Autowired
    private RedisUtils redisUtils;

    /**
     * ç¼–ç¨‹å¼äº‹åŠ¡ç¤ºä¾‹
     */
    public void createOrder(Order order) {
        redisUtils.tx().execute((operations) -> {
            try {
                // 1. å‡åº“å­˜
                String inventoryKey = "inventory:" + order.getProductId();
                Integer inventory = operations.opsForValue().get(inventoryKey);
                if (inventory == null || inventory < order.getQuantity()) {
                    throw new RuntimeException("åº“å­˜ä¸è¶³");
                }
                operations.opsForValue().set(inventoryKey, inventory - order.getQuantity());

                // 2. åˆ›å»ºè®¢å•
                String orderKey = "order:" + order.getOrderId();
                operations.opsForValue().set(orderKey, order);

                // 3. æ›´æ–°ç”¨æˆ·è®¢å•åˆ—è¡¨
                String userOrdersKey = "user:orders:" + order.getUserId();
                operations.opsForList().rightPush(userOrdersKey, order.getOrderId());

                // 4. è®°å½•è®¢å•ç»Ÿè®¡
                operations.opsForHash().increment("daily:order:stats",
                    DateUtil.format(new Date(), "yyyy-MM-dd"), 1);

                return null;
            } catch (Exception e) {
                // äº‹åŠ¡ä¼šè‡ªåŠ¨å›æ»š
                throw new RuntimeException("åˆ›å»ºè®¢å•å¤±è´¥", e);
            }
        });
    }
}
```

## ğŸ“Š ç¼“å­˜æ³¨è§£ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ç¼“å­˜æ³¨è§£

```java
@Service
public class UserService {

    /**
     * åŸºç¡€ç¼“å­˜ç¤ºä¾‹
     */
    @RedisCacheable(
        key = "'user:info:' + #userId",
        ttl = 1800, // 30åˆ†é’Ÿ
        condition = "#userId > 0"
    )
    public User getUserById(Long userId) {
        System.out.println("ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·: " + userId);
        // æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢
        return userRepository.findById(userId);
    }

    /**
     * é«˜çº§ç¼“å­˜ç¤ºä¾‹
     */
    @RedisCacheable(
        key = "'user:profile:' + #userId + ':' + #includePrivate",
        ttl = 3600,
        condition = "#result != null",
        type = UserProfile.class,
        cacheNullValues = false,
        warmUp = true,
        batchSize = 20,
        enableMetrics = true,
        refreshThreshold = 0.2
    )
    public UserProfile getUserProfile(Long userId, boolean includePrivate) {
        System.out.println("ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·èµ„æ–™: " + userId);
        return userRepository.findProfileById(userId, includePrivate);
    }

    /**
     * ç¼“å­˜æ¸…é™¤ç¤ºä¾‹
     */
    @RedisEvict(
        keys = {"'user:info:' + #userId", "'user:profile:' + #userId + ':*'"},
        condition = "#result != null"
    )
    public User updateUser(Long userId, User user) {
        System.out.println("æ›´æ–°ç”¨æˆ·ä¿¡æ¯: " + userId);
        User updated = userRepository.update(userId, user);

        // æ¸…é™¤ç›¸å…³ç¼“å­˜
        return updated;
    }

    /**
     * æ¸…é™¤æ‰€æœ‰ç”¨æˆ·ç¼“å­˜
     */
    @RedisEvict(
        allEntries = true,
        keyPrefix = "user:"
    )
    public void clearAllUserCache() {
        System.out.println("æ¸…é™¤æ‰€æœ‰ç”¨æˆ·ç¼“å­˜");
    }
}
```

### å¤šçº§ç¼“å­˜ç¤ºä¾‹

```java
@Service
public class ProductService {

    /**
     * å¤šçº§ç¼“å­˜ç¤ºä¾‹
     */
    @RedisCacheable(
        key = "'product:detail:' + #productId",
        ttl = 7200,
        levels = {CacheLevel.L1, CacheLevel.L2},
        updateStrategy = UpdateStrategy.WRITE_THROUGH,
        warmUp = true,
        warmUpPriority = WarmUpPriority.HIGH
    )
    public ProductDetail getProductDetail(Long productId) {
        System.out.println("æŸ¥è¯¢äº§å“è¯¦æƒ…: " + productId);
        return productRepository.findDetailById(productId);
    }

    /**
     * æ‰¹é‡ç¼“å­˜é¢„çƒ­ç¤ºä¾‹
     */
    @RedisCacheable(
        key = "'hot:products:' + #category",
        ttl = 3600,
        batchSize = 50,
        warmUp = true,
        warmUpDelayMs = 10000 // å»¶è¿Ÿ10ç§’é¢„çƒ­
    )
    public List<Product> getHotProducts(String category) {
        System.out.println("æŸ¥è¯¢çƒ­é—¨äº§å“: " + category);
        return productRepository.findHotProductsByCategory(category);
    }
}
```
